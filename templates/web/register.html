{% extends 'web/base.html' %}

{% block title %}KayÄ±t Ol - Safak{% endblock %}

{% block header_title %}âœ¨ KayÄ±t Ol{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- HoÅŸ Geldin KartÄ± -->
    <div class="card text-center" style="background: linear-gradient(135deg, var(--primary-red), var(--secondary-red)); color: var(--white);">
        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‰</div>
        <h1 style="color: var(--white); margin-bottom: 8px;">Safak Ailesine KatÄ±l</h1>
        <p style="color: rgba(255,255,255,0.9);">Ãœcretsiz kayÄ±t ol, indirim kuponunu hemen al!</p>
    </div>

    <!-- KayÄ±t Formu -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">KayÄ±t Ol</h2>
            <p class="card-subtitle">Bilgilerinizi girin</p>
        </div>

        <form method="post" class="form" id="registerForm">
            {% csrf_token %}
            
            <!-- KiÅŸisel Bilgiler -->
            <div class="form-group">
                <label for="first_name" class="form-label">ğŸ‘¤ Ad</label>
                <input 
                    type="text" 
                    id="first_name" 
                    name="first_name" 
                    class="form-input" 
                    placeholder="AdÄ±nÄ±z"
                    required
                    maxlength="30"
                >
            </div>

            <div class="form-group">
                <label for="last_name" class="form-label">ğŸ‘¤ Soyad</label>
                <input 
                    type="text" 
                    id="last_name" 
                    name="last_name" 
                    class="form-input" 
                    placeholder="SoyadÄ±nÄ±z"
                    required
                    maxlength="30"
                >
            </div>

            <div class="form-group">
                <label for="phone_number" class="form-label">ğŸ“± Telefon NumarasÄ±</label>
                <input 
                    type="tel" 
                    id="phone_number" 
                    name="phone_number" 
                    class="form-input" 
                    placeholder="5XXXXXXXXX"
                    required
                    maxlength="10"
                    pattern="[0-9]{10}"
                >
            </div>

            <!-- Åifre -->
            <div class="form-group">
                <label for="password" class="form-label">ğŸ”’ Åifre</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    class="form-input" 
                    placeholder="En az 8 karakter"
                    required
                    minlength="8"
                >
            </div>

            <div class="form-group">
                <label for="password_confirm" class="form-label">ğŸ”’ Åifre Tekrar</label>
                <input 
                    type="password" 
                    id="password_confirm" 
                    name="password_confirm" 
                    class="form-input" 
                    placeholder="Åifrenizi tekrar girin"
                    required
                    minlength="8"
                >
            </div>

            <!-- Ã‡ocuk Bilgileri -->
            <div class="form-group">
                <div class="form-checkbox">
                    <input type="checkbox" id="has_children" name="has_children">
                    <label for="has_children" class="form-label" style="margin-bottom: 0;">ğŸ‘¶ Ã‡ocuÄŸum var</label>
                </div>
            </div>

            <div class="form-group" id="children_count_group" style="display: none;">
                <label for="children_count" class="form-label">ğŸ‘¶ Ã‡ocuk SayÄ±sÄ±</label>
                <select id="children_count" name="children_count" class="form-select">
                    <option value="0">Ã‡ocuk sayÄ±sÄ±nÄ± seÃ§in</option>
                    <option value="1">1 Ã‡ocuk</option>
                    <option value="2">2 Ã‡ocuk</option>
                    <option value="3">3 Ã‡ocuk</option>
                    <option value="4">4 Ã‡ocuk</option>
                    <option value="5">5 Ã‡ocuk</option>
                </select>
            </div>

            <div id="children_container" style="display: none;"></div>

            <button type="submit" class="btn btn-primary btn-full">
                ğŸš€ KayÄ±t Ol
            </button>
        </form>
    </div>

    <!-- GiriÅŸ Yap KartÄ± -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">ğŸ” Zaten Ã¼ye misin?</h2>
            <p class="card-subtitle">Hemen giriÅŸ yap!</p>
        </div>

        <a href="{% url 'webapp:login' %}" class="btn btn-secondary btn-full">
            ğŸšª GiriÅŸ Yap
        </a>
    </div>

    <!-- GÃ¼venlik Bilgisi -->
    <div class="card" style="background: var(--gray-100);">
        <div class="card-header">
            <h2 class="card-title">ğŸ” GÃ¼venlik</h2>
        </div>
        
        <p style="color: var(--gray-700); font-size: 14px; line-height: 1.5;">
            Bilgileriniz gÃ¼venli bir ÅŸekilde ÅŸifrelenir ve korunur. 
            Telefon numaranÄ±z sadece giriÅŸ yapmak iÃ§in kullanÄ±lÄ±r.
        </p>
        
        <div class="text-center mt-2">
            <a href="{% url 'webapp:privacy_policy' %}" style="color: var(--primary-red); text-decoration: none; font-size: 14px;">
                ğŸ“‹ Gizlilik PolitikasÄ±
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Telefon numarasÄ± formatlamasÄ±
    const phoneInput = document.getElementById('phone_number');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) {
                value = value.slice(0, 10);
            }
            e.target.value = value;
        });
    }

    // Åifre eÅŸleÅŸme kontrolÃ¼
    const password = document.getElementById('password');
    const passwordConfirm = document.getElementById('password_confirm');
    
    function checkPasswordMatch() {
        if (password.value !== passwordConfirm.value) {
            passwordConfirm.setCustomValidity('Åifreler eÅŸleÅŸmiyor');
        } else {
            passwordConfirm.setCustomValidity('');
        }
    }

    password.addEventListener('input', checkPasswordMatch);
    passwordConfirm.addEventListener('input', checkPasswordMatch);

    // Ã‡ocuk bilgileri toggle
    const hasChildrenCheckbox = document.getElementById('has_children');
    const childrenCountGroup = document.getElementById('children_count_group');
    const childrenCountSelect = document.getElementById('children_count');
    const childrenContainer = document.getElementById('children_container');

    hasChildrenCheckbox.addEventListener('change', function() {
        if (this.checked) {
            childrenCountGroup.style.display = 'block';
        } else {
            childrenCountGroup.style.display = 'none';
            childrenContainer.style.display = 'none';
            childrenContainer.innerHTML = '';
            childrenCountSelect.value = '0';
        }
    });

    childrenCountSelect.addEventListener('change', function() {
        const count = parseInt(this.value);
        updateChildrenFields(count);
    });

    // Form submit validation
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        if (password.value !== passwordConfirm.value) {
            e.preventDefault();
            showMessage('Åifreler eÅŸleÅŸmiyor!', 'error');
            return;
        }
        
        // Debug: Form verilerini kontrol et
        const formData = new FormData(this);
        console.log('Form submit - tÃ¼m veriler:');
        for (let [key, value] of formData.entries()) {
            console.log(key + ': ' + value);
        }
        
        // Ã‡ocuk alanlarÄ±nÄ± Ã¶zellikle kontrol et
        const hasChildren = document.getElementById('has_children').checked;
        const childrenCount = document.getElementById('children_count').value;
        console.log('hasChildren:', hasChildren);
        console.log('childrenCount:', childrenCount);
        
        if (hasChildren && childrenCount > 0) {
            let childrenFound = 0;
            for (let i = 0; i < childrenCount; i++) {
                const childGrade = document.getElementById(`child_${i}_grade`);
                if (childGrade) {
                    console.log(`child_${i}_grade:`, childGrade.value);
                    if (childGrade.value) childrenFound++;
                } else {
                    console.error(`child_${i}_grade elementi bulunamadÄ±!`);
                }
            }
            
            if (childrenFound === 0) {
                e.preventDefault();
                showMessage('Ã‡ocuk sÄ±nÄ±f bilgilerini seÃ§in!', 'error');
                return;
            }
        }
    });
});
</script>
{% endblock %}